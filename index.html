<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>QR Code – Etiquetas Pimaco TR6571</title>

  <style>
    :root{
      --page-w: 8.5in;
      --page-h: 11in;

      --label-w: 88.9mm;
      --label-h: 60.1mm;

      --margin-left: 8mm;
      --margin-top: 12mm;
      --col-gap: 10mm;
      --row-gap: 6mm;

      --qr-size: 45mm;
    }

    body{
      font-family: Arial, Helvetica, sans-serif;
      background:#f3f4f6;
      margin:0;
      padding:12px;
      text-align:center;
      color:#111827;
    }

    p{
      font-size:14px;
      margin-bottom:10px;
    }

    #inputContainer{
      display:flex;
      justify-content:center;
      gap:8px;
      flex-wrap:wrap;
      margin-bottom:12px;
    }

    input{
      width:min(90vw,600px);
      padding:8px;
      border-radius:8px;
      border:1px solid #9ca3af;
    }

    button{
      padding:8px 14px;
      border-radius:8px;
      border:none;
      cursor:pointer;
      box-shadow:0 3px 8px rgba(0,0,0,.15);
    }

    #generateButton{
      background:linear-gradient(135deg,#10b981,#059669);
      color:#fff;
    }

    #printSelectedBtn{
      background:linear-gradient(135deg,#111827,#374151);
      color:#fff;
    }

    .panel{
      background:#fff;
      border-radius:14px;
      padding:14px;
      max-width:900px;
      margin:0 auto;
      box-shadow:0 6px 18px rgba(0,0,0,.08);
      text-align:left;
    }

    .previewBox{
      display:flex;
      gap:14px;
      align-items:center;
      margin-bottom:14px;
    }

    .previewBox img{
      width:110px;
      height:110px;
      border-radius:12px;
      border:1px solid #e5e7eb;
    }

    #slotGrid{
      display:grid;
      grid-template-columns:repeat(2,1fr);
      gap:10px;
      margin-top:12px;
    }

    .slotBtn{
      background:#fff;
      border:2px solid #e5e7eb;
      border-radius:14px;
      padding:14px;
      text-align:center;
      cursor:pointer;
      user-select:none;
    }

    .slotBtn.active{
      border-color:#2563eb;
      box-shadow:0 10px 18px rgba(37,99,235,.2);
    }

    .slotBtn strong{
      font-size:18px;
      display:block;
    }

    /* ===== LOGO RODAPÉ ===== */
    .brandFooter{
      margin-top:26px;
      text-align:center;
    }
    .brandFooter img{
      max-width:280px;
      width:80%;
      opacity:0.95;
    }

    /* ===== ÁREA DE IMPRESSÃO ===== */
    #labelSheet{
      display:none;
      width:var(--page-w);
      height:var(--page-h);
      padding-left:var(--margin-left);
      padding-top:var(--margin-top);
    }

    #labelGrid{
      display:grid;
      grid-template-columns:var(--label-w) var(--label-w);
      grid-auto-rows:var(--label-h);
      column-gap:var(--col-gap);
      row-gap:var(--row-gap);
    }

    .labelCell{
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .labelCell img{
      width:var(--qr-size);
      height:var(--qr-size);
      display:block;
    }

    /* ✅ IMPORTANTÍSSIMO:
       Esconde qualquer imagem sem src (evita o ícone de imagem quebrada no print preview) */
    .labelCell img:not([src]),
    .labelCell img[src=""]{
      display:none !important;
    }

    @page{
      size:Letter;
      margin:0;
    }

    @media print{
      body>*{display:none!important;}
      #labelSheet{display:block!important;}
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/qr-code-styling@1.5.0/lib/qr-code-styling.js"></script>
</head>

<body>

<p>
  Cole o link, gere o QR Code e escolha a posição da etiqueta.<br>
  <strong>Pimaco TR6571 – Letter (8 posições)</strong>
</p>

<div id="inputContainer">
  <input id="urlInput" placeholder="Cole o link do veículo aqui">
  <button id="generateButton" onclick="generateQR()">Gerar QR Code</button>
</div>

<div class="panel">

  <div class="previewBox">
    <img id="qrPreview" style="display:none" alt="Prévia do QR">
    <div>
      <strong>Pré-visualização</strong><br>
      QR Code gerado aparecerá aqui
    </div>
  </div>

  <div id="slotGrid">
    <div class="slotBtn" onclick="selectSlot(1)"><strong>1</strong>Topo esquerda</div>
    <div class="slotBtn" onclick="selectSlot(2)"><strong>2</strong>Topo direita</div>
    <div class="slotBtn" onclick="selectSlot(3)"><strong>3</strong>2ª linha esquerda</div>
    <div class="slotBtn" onclick="selectSlot(4)"><strong>4</strong>2ª linha direita</div>
    <div class="slotBtn" onclick="selectSlot(5)"><strong>5</strong>3ª linha esquerda</div>
    <div class="slotBtn" onclick="selectSlot(6)"><strong>6</strong>3ª linha direita</div>
    <div class="slotBtn" onclick="selectSlot(7)"><strong>7</strong>Base esquerda</div>
    <div class="slotBtn" onclick="selectSlot(8)"><strong>8</strong>Base direita</div>
  </div>

  <div style="margin-top:14px">
    <button id="printSelectedBtn" onclick="printSelected()">Imprimir na posição selecionada</button>
  </div>

</div>

<!-- LOGO MULTIMARCAS (tela apenas) -->
<div class="brandFooter">
  <img src="SM_MULTIMARCAS_preto.png" alt="San Marino Multimarcas">
</div>

<div id="qrHidden" style="display:none"></div>

<!-- Folha de impressão -->
<div id="labelSheet">
  <div id="labelGrid">
    <div class="labelCell" data-cell="1"><img alt=""></div>
    <div class="labelCell" data-cell="2"><img alt=""></div>
    <div class="labelCell" data-cell="3"><img alt=""></div>
    <div class="labelCell" data-cell="4"><img alt=""></div>
    <div class="labelCell" data-cell="5"><img alt=""></div>
    <div class="labelCell" data-cell="6"><img alt=""></div>
    <div class="labelCell" data-cell="7"><img alt=""></div>
    <div class="labelCell" data-cell="8"><img alt=""></div>
  </div>
</div>

<script>
  let qrData = "";
  let selectedSlot = 1;

  function selectSlot(n){
    selectedSlot = n;
    document.querySelectorAll('.slotBtn').forEach((b,i)=>{
      b.classList.toggle('active', i+1 === n);
    });
    if(qrData) placeQR();
  }

  async function generateQR(){
    const url = urlInput.value.trim();
    if(!url) return alert("Informe um link");

    const qr = new QRCodeStyling({
      width: 300,
      height: 300,
      data: url,
      dotsOptions: { color:"#000" },
      backgroundOptions: { color:"#fff" }
    });

    qrHidden.innerHTML = "";
    qr.append(qrHidden);

    const blob = await qr.getRawData("png");
    qrData = await new Promise(resolve => {
      const fr = new FileReader();
      fr.onload = () => resolve(fr.result);
      fr.readAsDataURL(blob);
    });

    qrPreview.src = qrData;
    qrPreview.style.display = "block";

    placeQR();
  }

  function clearAllLabelImgs(){
    // ✅ Em vez de img.src = "" (que gera ícone quebrado),
    // removemos o atributo src de todos.
    document.querySelectorAll('.labelCell img').forEach(img => {
      img.removeAttribute('src');
    });
  }

  function placeQR(){
    clearAllLabelImgs();
    const target = document.querySelector(`.labelCell[data-cell="${selectedSlot}"] img`);
    if(target){
      target.setAttribute('src', qrData);
    }
  }

  function printSelected(){
    if(!qrData) return alert("Gere o QR primeiro");
    placeQR();
    window.print();
  }

  selectSlot(1);
</script>

</body>
</html>